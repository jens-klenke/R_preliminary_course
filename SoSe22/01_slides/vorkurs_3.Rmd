---
title: "R-Vorkurs"
subtitle: "Teil 3"
author: "Martin Arnold, Janine Langerbein, Marco Schwarzbach"
date: "7.10.2021"
output:
  xaringan::moon_reader:
    css: ["default", "assets/sydney-fonts.css", "assets/sydney.css"]
    self_contained: true # if true, fonts will be stored locally
    seal: true # show a title slide with YAML information
    includes:
      in_header: "assets/mathjax-equation-numbers.html"
    nature:
      beforeInit: ["assets/remark-zoom.js", "https://platform.twitter.com/widgets.js"]
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9' #alternatives '16:9' or '4:3' or others e.g. 13:9
      navigation:
        scroll: true #disable slide transitions by scrolling
---
class: inverse
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, small = T)

options(htmltools.dir.version = FALSE)
options(servr.daemon = TRUE)
options(servr.interval = 0.5)

library(icons)

r_white <- icon_style(fontawesome$brands$'r-project', fill = "white")
r_black <- icon_style(fontawesome$brands$'r-project', fill = "black")
r_blue <- icon_style(fontawesome$brands$'r-project', fill = "#004c93")

#### required packages ####
# packages
suppressWarnings(source(here::here('00_packages/packages.R')))
```

# Übersicht 

<br></br>

1. Verteilungen und Zufallszahlen
2. Grafiken
3. Lineare Regression

---
## Verteilungen und Zufallszahlen
### Verteilungen

R kennt standardmäßig viele diskrete Verteilungen, z.B.
.font80[
- Binomialverteilung (`binom`)
- Geometrische Verteilung (`geom`)
- Hypergeometrische Verteilung (`hyper`)
- Poisson-Verteilung (`pois`)
- ...

...sowie stetige Verteilungen:

- Normalverteilung (`norm`)
- t-Verteilung (`t`)
- Chi-Quadrat-Verteilung (`chisq`)
- F-Verteilung (`f`)
- Gleichverteilung (`unif`)
- ...
]
---
## Verteilungen 
### `r r_blue`-Funktionen

.font90[
Für jede Verteilung stehen vier Funktionen zur Verfügung:

- Berechnung von Punktwahrscheinlichkeiten/-dichten $\Rightarrow$ Präfix .blue[d] (.blue[d]ensity)
- Werte der Verteilungsfunktion $\Rightarrow$ Präfix .green[p] (.green[p]robability)
- Berechnen von Quantilen $\Rightarrow$ Präfix .red[q] (.red[q]uantile)
- Erzeugen von 'Zufallszahlen' $\Rightarrow$ Präfix .orange[r] (.orange[r]andom)

$\Longrightarrow$ Name der Funktion = Präfix + Verteilungskürzel (siehe vorherige Folie)

<b>Beispiel:</b> 

- Quantil der Normalverteilung: .red[q] + norm = `qnorm()`
- Verteilungsfunktion der Binomialverteilung: .green[p] + binom = `pbinom()`
- etc.
]

---
## Verteilungen 
### Beispiel &mdash; Chi-Quadrat-Verteilung

```{r, echo = F,fig.align='center', dpi=200, out.width=500, fig.asp=2/3}
par(mar=c(5.1, 4.1, 0, 2.1))
plot(seq(0, 50, 0.01),dchisq(seq(0, 50, 0.01), df = 10), type = 'l', xlab = "x", ylab = "f(x)")
lines(c(12, 12),c(-2, dchisq(12, 10)), col = "red", lwd = 2)
lines(c(-2, 12),rep(dchisq(12, 10), 2), col = "red", lwd = 2)
```

```{r}
dchisq(12, df = 10)  # Dichte an der Stelle x=12
```

---
## Verteilungen 
### Beispiel &mdash; Chi-Quadrat-Verteilung

.font90[
Analog erhalten wir für die gleiche Verteilung Werte der Verteilungsfunktion:

```{r}
pchisq(8, df = 10)  # Wert der Verteilungsfunktion an der Stelle x=8
```

...ein bestimmtes Quantil

```{r}
qchisq(0.5, df = 10)  # 0.5-Quantil der Verteilung
```

...sowie Zufallszahlen

```{r}
rchisq(5, df = 10)  # 5 chi^2-verteilte Zufallszahlen
```
]

---
## Verteilungen 
### Seeds

.font80[
Wiederholen wir den Code von Slide 7, erhalten wir andere zufällige Zahlen.

```{r}
rchisq(5, df = 10)
```

Manchmal wollen wir Ergebnisse reproduzierbar machen. Dann muss ein sog. *seed* gesetzt werden. Damit können an jedem Computer die selben Zufallszahlen erzeugt werden.

```{r}
set.seed(385)      # 385 ist ein Beispiel -- probiert andere seeds aus!
rchisq(5, df = 10)
```

```{r}
set.seed(385)
rchisq(5, df = 10)
```

]

---
## Verteilungen 
### <code>sample()</code>

Neben der Erzeugung von Zufallszahlen aus vordefinierten Verteilungen, kann man auch 'eigene' Zufallsexperimente durchführen

```{r}
# Beispiel Münzwurf:

# Mögliche Ergebnisse definieren
K_Z <- c('Kopf', 'Zahl')

# Fünfmaliges Werfen einer *fairen* Münze
# ( standardwert prob = 1/length(K_Z) )
sample(K_Z, size = 5, replace = TRUE, prob = c(0.5, 0.5)) 

# Fünfmaliges Werfen einer *unfairen* Münze
sample(K_Z, size = 5, replace = TRUE, prob = c(0.8, 0.2))
```

---
## Verteilungen 
### Übungsaufgaben

.font90[
1. Sei $X\sim t(5)$. Berechne $P(X<6)$, $P(3<X\leq7)$ und $P(X>4)$.
2. Berechne das 0.95-Quantil einer $F(4,5)$-verteilten Zufallsvariable.
3. Berechne die Wahrscheinlichkeit dafür, den Jackpot im Lotto zu gewinnen (d.h. 6 Richtige aus 49). Vernachlässige Zusatz- und Superzahlen (*Hinweis*: Benutze die hypergeometrische Verteilung).
4. Erzeuge 20 $\chi^2(5)$-verteilte Zufallszahlen ohne (!) dabei die `rchisq()`-Funktion zu benutzen 
(*Hinweis*: $\chi^2(n)=\sum_{i=1}^n Z_i^2$ mit $Z_i\sim\mathcal{N}(0,1)$ für alle $i=1,...,n$).
5. Ziehe 10 mal $n = 10000$ standardnormalverteilte Zufallszahlen und berechne für jede Ziehung das arithmetische Mittel. Betrachte alle 10 Mittelwerte. Was fällt auf? Zusatz: Wiederhole die Simulation mit $X \sim t(1)$-verteilten Zufallszahlen (Cauchy-Verteilung) Was fällt nun auf? Erkläre! (*Hinweis*: Wikipedia-Eintrag zur [Cauchy-Verteilung](https://en.wikipedia.org/wiki/Cauchy_distribution)).
6. Zusatz: Prüfe, dass das Integral über die Dichtefunktion einer $\chi^2(15)$-verteilten Zufallsvariable 1 ist. (*Hinweis*: Nutze `integrate()` zum Integrieren einer `r r_black`-Funktion)
]

---
## Grafiken
### Basic Plot

Mit `r r_black` ist es einfach Grafiken zu erstellen, z. B. einen *Scatterplot*...

```{r, echo = -1,fig.align='center', dpi=200, out.width=600, fig.asp=2/3}
set.seed(385)
plot(rnorm(10))
```

---
## Grafiken
### Basic Plot

...oder einen Linienplot in roter Farbe

```{r, echo = -1,fig.align='center', dpi=200, out.width=600, fig.asp=2/3}
set.seed(385)
plot(rnorm(10), type = 'l', col = 'red')
```

---
## Grafiken
### Cosmetics

Neben Argumenten wie `col` können weitere Eigenschaften des Plots angepasst werden, z.B.:

- `xlab`/`ylab`: Beschriftung von x-/y-Achse
- `xlim`/`ylim`: Darzustellender Bereich von x-/y-Achse
- `main`/`sub`: Titel/Untertitel der Grafik
- `pch`: Symbol für Datenpunkte in einer Grafik (Kreis, Quadrat, Dreieck etc.)
- `lty`/`lwd`: Darstellung (durchgezogen, gestrichelt, etc.) und Breite von Linien in einer Grafik
- uvm. (siehe `?par`)

---
## Grafiken
### Mehrere Grafiken

Für mehrere Grafiken in einem plot muss der Parameter `mfrow` genutzt werden:

```{r, echo = -1, fig.align='center', dpi=200, out.width=600, fig.asp=0.3}
par(mar = c(2.1, 4.1, 0, 2.1))
par(mfrow = c(1, 2))  # Zwei Plots in einer Zeile (bzw. in zwei Spalten)
plot(1:10, xlab = 'x', ylab = 'y')
plot(1:10, xlab = 'x', ylab = 'y', type = 'l')
```

Man beachte, dass dies eine *globale* Einstellung ist. Will man also wieder zum ursprünglichen Set-Up zurück, muss man mit `dev.off()` zurücksetzen.

---
## Grafiken
### Weitere Grafikenformen

`hist()`, `boxplot()`, `barplot()` und `pie()`.

<b>Beispiel:</b>

```{r, fig.align='center', dpi=200, out.width=600, fig.asp=0.6}
hist(mtcars$mpg, breaks = 5, freq = F, main = '', xlab = 'Miles per gallon')
```

---
## Grafiken
### Funktionen, die grafische Elemente hinzufügen

Es gibt auch Funktionen, die eine bestehende Grafik voraussetzen, bspw.

- `lines()`
- `points()`
- `abline()`
- `legend()`
- `text()`
- `arrows()`

Bis auf `abline()` erwarten alle Funktionen X- und Y-Koordinaten.

---
## Grafiken
### Funktionen, die grafische Elemente hinzufügen &mdash; Beispiel

```{r, echo=-1, fig.align='center', fig.align='center', dpi=200, out.width=650, fig.asp=0.5}
par(mar = c(4.1, 4.1, 2, 2.1))
hist(rnorm(10000), freq = F, ylim = c(0, 0.5), xlab = '', main = 'Empirical vs. theoretical')
x <- seq(-5, 5, 0.01)
y <- dnorm(x)
lines(x, y, col = 'red')
```

---
## Grafiken
### Übungsaufgaben

```{r, fig.asp = 0.45}
set.seed(385)
results <- rnorm(1000, mean = 100, sd = 15)
```

.font90[
1. Kopiere obigen Code und nimm an, dass dieser eine IQ-Testreihe mit 1000 Probanden simuliert. Zeichne ein Histogram der Ergebnisse. Beschrifte den plot und setze die Bereiche von X- und Y-Achse auf $[40,160]$ und $[0,0.03]$.

2. Zeichne die zugrundeliegende theoretische Dichtefunktion, d.h. eine Normalverteilung mit $\mu=100$ und $\sigma=15$, in den Plot.

3. Zeichne ein blaues Dreieck an das Maximum der theoretischen Dichte.

4. Markiere sowohl das 0.025- als auch das 0.975-Quantil der theoretischen Dichte mit vertikalen grünen Linien.
]

---
## Lineare Regression

### Modell

<!--Hauptaufgabe der Ökonometrie ist es, ?konomische Zusammenh?nge zu quantifizieren. Das Herzstück dabei bildet die Regressionsanalyse.-->
.font80[
Einfaches (univariates) lineares Regressionsmodell:

$$Y_t=\beta_0+\beta_1 X_t+u_t,\quad t=1,\ldots,T,$$
  
wobei

+ $Y_t$ - Regressand (zu erklärende Variable),
+ $X_t$ - Regressor (erklärende Variable),
+ $u_t$ - Fehlerterm.

Mit KQ-Methode können wir die Koeffizientenschätzer $\widehat{\beta_0}$ und $\widehat{\beta_1}$ erhalten.
  
<b>Beispiel</b>:

Im Datensatz **mtcars** sind reichlich Informationen zu verschiedenen Automodellen hinterlegt. Wir vermuten, dass die Reichweite eines Autos (*mpg*) davon abhängt, wie schwer es ist (*wt*). D.h. wir hätten folgendes Modell:

$$mpg_t=\beta_0 + \beta_1 wt_t + u_t$$ 

(Welche Richtung hat dieser Zusammenhangs vermutlich?)
]

---
## Lineare Regression
### Parameterschätzung

</br>

Einfache lineare Regression über `lm()` (= linear model)

```{r}
model <- lm(mpg ~ wt, data = mtcars)
```

Die Ergebnisse werden in einer Liste gespeichert

```{r}
names(model)
```

---
## Lineare Regression
### Regressionsoutput

Einen kompakten Überblick über die wichtigsten Informationen erhält man mit `summary()`

.font80[
```{r}
summary(model)
```
]

---
## Lineare Regression
### Punktewolke und Regressionsgerade

```{r, fig.align='center', dpi=200, out.width=600, fig.asp=0.7}
plot(mtcars$wt, mtcars$mpg, xlab = 'Weight', ylab = 'Miles per gallon')
abline(model, col = 'red')
```

---
## Lineare Regression
### Vorhersage

</br>

Mit dem geschätzten Modell können wir Vorhersagen machen. Angenommen ein neues Auto mit einem Gewicht von $X_{new}=3$ (in 1000 lbs) kommt auf den Markt. Was für eine Reichweite schätzen wir für dieses Auto?

```{r}
new_weight <- data.frame(wt = 3)
predict(model, newdata = new_weight)
```

---
## Lineare Regression
### Dummy-Variablen/Regression ohne Achsenabschnitt

.font80[
Kategorische Variablen (hier Getriebeart *am* mit Automatik = 0, manuell = 1) können über die Funktion `factor()` als  Regressor mitaufgenommen werden.

```{r}
model_wd <- lm(mpg ~ wt + factor(am), data = mtcars)
model_wd$coefficients
```
   
Will man eine Regression ohne Achsenabschnitt ( $\beta_0$ ) durchführen, bedarf es einer `-1` (oder alternativ <code>+0</code> ) am Ende der Regressionsformel.

```{r}
model_wd_no_int <- lm(mpg ~ wt + factor(am) - 1, data = mtcars)
model_wd_no_int$coefficients
```
   
]

---
## Lineare Regression
### Übungsaufgaben

.font90[
1. Betrachte im Folgenden den Datensatz `faithful`, der Daten zum [Old Faithful Geysir](https://de.wikipedia.org/wiki/Old_Faithful) im Yellowstone Nationalpark enthält. Sowohl die Dauer einer Eruption in Min. (`eruptions`) als auch die Wartezeit bis zur nächsten Eruption in Min. (`waiting`) sind als Variablen im Datensatz verfügbar. Unterstelle das Regressionsmodell $$\text{waiting}_t=\beta_0+\beta_1 \text{eruptions}_t + u_t$$ und schätze die Parameter $\beta_0$, $\beta_1$. Zeichne anschließend eine geeignete Grafik und interpretiere.

2. Erhalte mit `summary()` einen Überblick über die Regression aus 1. Interpretiere die geschätzten Koeffizienten und speichere anschließend das $R^2$ (*Multiple R-squared*) in `R2`.

3. Angenommen wir beobachten einen weiteren Datenpunkt für die Dauer einer Eruption $X_{new}=4$. Triff eine Vorhersage für die Wartezeit bis zur nächsten Eruption!
<!-- 4. Betrachten Sie nun den aus den Folien bekannten Datensatz **mtcars**. Regressieren Sie die Reichweite (*mpg*) auf die Getriebeart (*am* mit Automatik = 0, Manuell = 1) und lassen Sie den Achsenabschnitt weg. Interpretieren Sie ihr Ergebnis. -->
]











